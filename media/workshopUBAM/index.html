<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Sorteio Musicoterapia</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f0f4f8;
      padding: 30px;
      margin: 0;
      display: flex;
      flex-direction: row;
    }

    .main-content {
      flex: 1;
      max-width: calc(100% - 650px); /* espa√ßo para a barra lateral */
      padding-right: 20px;
    }

    h1, h3 {
      text-align: center;
      color: #2c3e50;
    }

    .section {
      background: #ffffff;
      padding: 20px;
      margin: 20px auto;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
      max-width: 800px;
    }

    input[type="text"] {
      width: calc(100% - 20px);
      padding: 10px;
      margin: 10px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 15px;
    }

    button {
      padding: 8px 14px;
      margin: 5px 4px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s ease;
    }

    button:hover {
      background-color: #2980b9;
    }

    .remove-btn {
      background-color: #e74c3c;
    }

    .remove-btn:hover {
      background-color: #c0392b;
    }

    .population, .participant-item {
      border: 1px solid #ddd;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 8px;
      background: #f9f9f9;
    }

    .objectives {
      margin-top: 10px;
      padding-left: 15px;
      color: #555;
    }

    .results {
      white-space: pre-wrap;
      background: #ecf3fc;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #cde;
      font-family: monospace;
      font-size: 15px;
      color: #2c3e50;
    }

    .link-lab {
      text-align: center;
      margin-bottom: 15px;
    }

    .link-lab a {
      font-size: 16px;
      color: #2d77ff;
      text-decoration: none;
    }

    .link-lab a:hover {
      text-decoration: underline;
    }

    .sidebar {
      width: 650px;
      background-color: #fff8dc;
      border-left: 2px solid #f0d98c;
      padding: 25px 20px 20px 20px;
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      overflow-y: auto;
      box-sizing: border-box;
    }

    .sidebar h3 {
      position: sticky;
      top: 0;
      background: #fff8dc;
      padding-bottom: 10px;
      margin: 0 0 10px 0;
      border-bottom: 2px solid #f0d98c;
      font-weight: 700;
      font-size: 20px;
      z-index: 10;
    }

    .sidebar ul {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
      gap: 10px;
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .sidebar li {
      background: #ffeebb;
      padding: 10px 14px;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 600;
      color: #333;
      box-shadow: 1px 1px 3px rgba(0,0,0,0.08);
      white-space: nowrap;
      text-align: center;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.2s ease;
    }

    .sidebar li:hover {
      background-color: #ffd966;
    }
/* Biblioteca rodap√© */
.library {
  background: #fff8dc;
  border-top: 2px solid #f0d98c;
  padding: 20px;
  margin-top: 30px;       /* mais espa√ßo acima para destacar */
  max-width: 800px;
  margin-left: auto;
  margin-right: auto;
  border-radius: 8px;
  color: #333;
  font-size: 15px;
  max-height: none;       /* remover limite de altura */
  overflow-y: visible;    /* remover scroll vertical */
}

.library h3 {
  margin-top: 0;
  font-weight: 700;
  color: #2c3e50;
}

.library ul {
  padding-left: 20px;
  margin-top: 10px;
  max-height: none;       /* remover limite de altura */
  overflow-y: visible;    /* remover scroll vertical */
}

.library li {
  margin-bottom: 14px;    /* um pouco mais espa√ßado entre itens */
}

.library strong {
  color: #2980b9;
}

  </style>
</head>
<body>

  <div class="main-content">
    <h1>üé∂ Sorteio de Atividades Musicoterap√™uticas</h1>
    <div class="link-lab">
      üîó <a href="https://musiclab.chromeexperiments.com/" target="_blank">Acesse o Google Chrome Music Lab</a>
    </div>

    <div class="section">
      <h3>1. Adicionar Popula√ß√£o Cl√≠nica</h3>
      <input type="text" id="popInput" placeholder="Ex: Crian√ßas com autismo" />
      <button onclick="addPopulation()">+ Adicionar Popula√ß√£o</button>
      <div id="populationsContainer"></div>
    </div>

    <div class="section">
      <h3>2. Adicionar Participantes</h3>
      <input type="text" id="participantInput" placeholder="Nome do participante" />
      <button onclick="addParticipant()">+ Adicionar Participante</button>
      <div id="participantsList"></div>
      <button onclick="sortear()">üé≤ Sortear</button>
    </div>

    <div class="section">
      <h3>3. Resultado do Sorteio</h3>
      <div class="results" id="results">Nenhum sorteio realizado ainda.</div>
    </div>

    <div class="library">
      <h3>üìö Biblioteca das Ferramentas do Chrome Music Lab</h3>
      <ul id="libraryList"></ul>
    </div>
  </div>

  <div class="sidebar">
    <h3>üìå Palavras-chave dispon√≠veis</h3>
    <ul id="listaPalavrasChave"></ul>
  </div>

  <script>
    // Biblioteca com ferramentas e descri√ß√µes
    const bibliotecaFerramentas = [
      { nome: "Shared Piano", descricao: "Incr√≠vel para atendimentos de musicoterapia online. Permite tocar piano com m√∫ltiplos usu√°rios simultaneamente." },
      { nome: "Song Maker", descricao: "Cria√ß√£o e edi√ß√£o de m√∫sicas simples, com ritmo, melodia e harmonia." },
      { nome: "Rhythm", descricao: "Explora√ß√£o e cria√ß√£o de padr√µes r√≠tmicos e movimentos corporais." },
      { nome: "Spectrogram", descricao: "Visualiza√ß√£o gr√°fica do espectro sonoro, √∫til para percep√ß√£o auditiva." },
      { nome: "Sound Waves", descricao: "Visualiza√ß√£o das ondas sonoras e experimenta√ß√£o com frequ√™ncias." },
      { nome: "Arpeggios", descricao: "Explora√ß√£o de sequ√™ncias de notas tocadas em sucess√£o r√°pida." },
      { nome: "Kandinsky", descricao: "Gera√ß√£o visual e sonora interativa baseada em formas e cores." },
      { nome: "Voice Spinner", descricao: "Manipula√ß√£o de grava√ß√µes de voz com efeitos de looping e varia√ß√µes." },
      { nome: "Harmonics", descricao: "Explora√ß√£o de sons harm√¥nicos e suas rela√ß√µes musicais." },
      { nome: "Piano Roll", descricao: "Visualiza√ß√£o e edi√ß√£o de notas musicais em formato de piano roll." },
      { nome: "Oscillators", descricao: "Gera√ß√£o de sons baseados em ondas oscilat√≥rias, √∫til para est√≠mulos sonoros e movimento." },
      { nome: "Strings", descricao: "Explora√ß√£o sonora de instrumentos de cordas virtuais." },
      { nome: "Melody Maker", descricao: "Cria√ß√£o e edi√ß√£o de melodias com v√°rias op√ß√µes de notas e escalas." },
      { nome: "Chords", descricao: "Cria√ß√£o e experimenta√ß√£o com acordes musicais." }
    ];

    // Mapeamento palavras-chave para ferramentas
    const palavraParaFerramentas = {
      "express√£o": ["Kandinsky", "Song Maker"],
      "emo√ß√£o": ["Kandinsky", "Song Maker"],
      "sentimento": ["Kandinsky", "Song Maker"],
      "afetividade": ["Kandinsky", "Song Maker"],
      "catarsis": ["Kandinsky", "Song Maker"],
      "comunica√ß√£o": ["Song Maker", "Rhythm"],
      "linguagem": ["Song Maker", "Rhythm"],
      "intera√ß√£o": ["Song Maker", "Rhythm"],
      "di√°logo": ["Song Maker", "Rhythm"],
      "socializa√ß√£o": ["Song Maker", "Rhythm"],
      "coordena√ß√£o": ["Rhythm", "Oscillators"],
      "motora": ["Rhythm", "Oscillators"],
      "gesto": ["Rhythm", "Oscillators"],
      "movimento": ["Rhythm", "Oscillators"],
      "corporal": ["Rhythm", "Oscillators"],
      "escuta": ["Sound Waves", "Spectrogram", "Harmonics"],
      "audi√ß√£o": ["Sound Waves", "Spectrogram", "Harmonics"],
      "aten√ß√£o": ["Sound Waves", "Spectrogram"],
      "foco": ["Sound Waves", "Spectrogram"],
      "concentra√ß√£o": ["Sound Waves", "Spectrogram"],
      "percep√ß√£o": ["Sound Waves", "Spectrogram", "Harmonics"],
      "cria√ß√£o": ["Song Maker", "Kandinsky", "Melody Maker", "Voice Spinner"],
      "criatividade": ["Song Maker", "Kandinsky", "Melody Maker", "Voice Spinner"],
      "improvisa√ß√£o": ["Song Maker", "Kandinsky", "Melody Maker", "Shared Piano"],
      "compor": ["Song Maker", "Melody Maker", "Chords", "Piano Roll"],
      "inventar": ["Song Maker", "Kandinsky", "Melody Maker"],
      "l√∫dico": ["Song Maker", "Kandinsky"],
      "organiza√ß√£o": ["Rhythm", "Melody Maker", "Chords"],
      "estrutura": ["Rhythm", "Melody Maker", "Chords"],
      "sequ√™ncia": ["Rhythm", "Melody Maker", "Chords"],
      "tempo": ["Rhythm", "Melody Maker", "Chords"],
      "padr√£o": ["Rhythm", "Melody Maker", "Chords"],
      "repeti√ß√£o": ["Rhythm", "Melody Maker", "Chords"],
      "afina√ß√£o": ["Melody Maker", "Song Maker", "Chords"],
      "nota": ["Melody Maker", "Song Maker", "Piano Roll", "Chords"],
      "notas": ["Melody Maker", "Song Maker", "Piano Roll", "Chords"],
      "escala": ["Melody Maker", "Song Maker", "Piano Roll"],
      "melodia": ["Melody Maker", "Song Maker"],
      "harmonia": ["Melody Maker", "Song Maker", "Chords"],
      "intervalo": ["Melody Maker", "Song Maker"],
      "visual": ["Kandinsky", "Spectrogram"],
      "auditivo": ["Sound Waves", "Spectrogram"],
      "sensorial": ["Kandinsky", "Spectrogram"],
      "sinestesia": ["Kandinsky"],
      "est√≠mulo": ["Kandinsky", "Sound Waves", "Oscillators"],
      "sentidos": ["Kandinsky", "Sound Waves"],
      "relaxamento": ["Song Maker (modo lento)", "Spectrogram"],
      "ansiedade": ["Song Maker (modo lento)", "Spectrogram"],
      "calma": ["Song Maker (modo lento)", "Spectrogram"],
      "respira√ß√£o": ["Song Maker (modo lento)", "Spectrogram"],
      "tranquilidade": ["Song Maker (modo lento)", "Spectrogram"],
      "grupo": ["Rhythm (em duplas)", "Song Maker (colaborativo)"],
      "v√≠nculo": ["Rhythm (em duplas)", "Song Maker (colaborativo)"],
      "empatia": ["Rhythm (em duplas)", "Song Maker (colaborativo)"],
      "espelhamento": ["Rhythm (em duplas)", "Song Maker (colaborativo)"],
      "rela√ß√£o": ["Rhythm (em duplas)", "Song Maker (colaborativo)"],
      "troca": ["Rhythm (em duplas)", "Song Maker (colaborativo)"]
    };

    // Extrair palavras-chave √∫nicas e ordenar
    const palavrasChave = Object.keys(palavraParaFerramentas).sort();

    let populations = [];
    let participants = [];

    function addPopulation() {
      const popName = document.getElementById('popInput').value.trim();
      if (!popName) return;
      populations.push({ name: popName, objectives: [] });
      document.getElementById('popInput').value = '';
      renderPopulations();
    }

    function addObjective(index) {
      const objInput = document.getElementById(`objInput${index}`);
      const objective = objInput.value.trim();
      if (!objective) return;
      populations[index].objectives.push(objective);
      objInput.value = '';
      renderPopulations();
    }

    function removePopulation(index) {
      populations.splice(index, 1);
      renderPopulations();
    }

    function renderPopulations() {
      const container = document.getElementById('populationsContainer');
      container.innerHTML = '';
      populations.forEach((pop, index) => {
        const div = document.createElement('div');
        div.className = 'population';
        div.innerHTML = `
          <strong>${pop.name}</strong>
          <button class="remove-btn" onclick="removePopulation(${index})">Remover</button>
          <div class="objectives">
            ${pop.objectives.length ? pop.objectives.map(obj => `<div>‚Ä¢ ${obj}</div>`).join('') : '<em>Nenhum objetivo ainda</em>'}
          </div>
          <input type="text" id="objInput${index}" placeholder="Adicionar objetivo cl√≠nico..." 
                 onkeydown="if(event.key==='Enter') addObjective(${index})" 
                 oninput="mostrarSugestaoFerramenta(${index})" />
          <div id="sugestao${index}" style="font-size: 13px; color: #555; margin-top: 4px;"></div>
          <button onclick="addObjective(${index})">+ Objetivo</button>
        `;
        container.appendChild(div);
      });
    }

    function addParticipant() {
      const input = document.getElementById('participantInput');
      const name = input.value.trim();
      if (!name) return;
      participants.push(name);
      input.value = '';
      renderParticipants();
    }

    function removeParticipant(index) {
      participants.splice(index, 1);
      renderParticipants();
    }

    function renderParticipants() {
      const list = document.getElementById('participantsList');
      list.innerHTML = '';
      participants.forEach((name, index) => {
        const div = document.createElement('div');
        div.className = 'participant-item';
        div.innerHTML = `
          <strong>${name}</strong>
          <button class="remove-btn" onclick="removeParticipant(${index})">Remover</button>
        `;
        list.appendChild(div);
      });
    }

    function sugerirFerramenta(texto) {
      texto = texto.toLowerCase();
      for (let palavra in palavraParaFerramentas) {
        if (texto.includes(palavra)) {
          return palavraParaFerramentas[palavra].join(", ");
        }
      }
      return "Escolha livre no Music Lab üéß";
    }

    function mostrarSugestaoFerramenta(index) {
      const objInput = document.getElementById(`objInput${index}`);
      const sugestaoDiv = document.getElementById(`sugestao${index}`);
      const texto = objInput.value.toLowerCase().trim();

      const ferramenta = sugerirFerramenta(texto);
      let sugestaoHTML = `üéß <strong>Sugest√£o de ferramenta:</strong> ${ferramenta}<br/>`;

      if (texto.length >= 1) {
        const sugestoes = palavrasChave.filter(p => p.startsWith(texto)).slice(0, 5);
        if (sugestoes.length) {
          sugestaoHTML += `üîç <strong>Palavras-chave:</strong> ${sugestoes.join(", ")}`;
        }
      }

      sugestaoDiv.innerHTML = sugestaoHTML;
    }

    // Sorteio
    function sortear() {
      const resultsDiv = document.getElementById('results');
      if (participants.length === 0 || populations.length === 0) {
        alert("Adicione participantes e popula√ß√µes cl√≠nicas.");
        return;
      }
      const output = [];
      const usedPopulations = new Set();

      participants.forEach((name) => {
        let popOptions = populations.filter((_, idx) => !usedPopulations.has(idx));
        if (popOptions.length === 0) popOptions = populations;
        const popIndex = populations.indexOf(popOptions[Math.floor(Math.random() * popOptions.length)]);
        usedPopulations.add(popIndex);
        const pop = populations[popIndex];

        let chosenObjective = '';
        let sugestao = '';
        if (pop.objectives.length === 0) {
          chosenObjective = '‚ö†Ô∏è Sem objetivo cl√≠nico definido.';
          sugestao = 'Sem sugest√£o de ferramenta.';
        } else {
          if (!pop._usedObjectives) pop._usedObjectives = new Set();
          let availableObjectives = pop.objectives.filter((_, idx) => !pop._usedObjectives.has(idx));
          if (availableObjectives.length === 0) {
            pop._usedObjectives = new Set();
            availableObjectives = pop.objectives;
          }
          const objIndex = pop.objectives.indexOf(availableObjectives[Math.floor(Math.random() * availableObjectives.length)]);
          pop._usedObjectives.add(objIndex);
          chosenObjective = pop.objectives[objIndex];
          sugestao = sugerirFerramenta(chosenObjective);
        }

        output.push(`${name}:\nPopula√ß√£o: ${pop.name}\nObjetivo: ${chosenObjective}\nüéß Sugest√£o de ferramenta: ${sugestao}\n`);
      });

      resultsDiv.textContent = output.join('\n---\n');
    }

    // Preencher palavras-chave na sidebar e adicionar clique para inserir no √∫ltimo input objetivo
    function preencherPalavrasChave() {
      const ul = document.getElementById('listaPalavrasChave');
      ul.innerHTML = '';
      palavrasChave.forEach(palavra => {
        const li = document.createElement('li');
        li.textContent = palavra;
        li.title = `Inserir "${palavra}" no objetivo cl√≠nico da √∫ltima popula√ß√£o`;
        li.addEventListener('click', () => {
          if (populations.length === 0) {
            alert("Adicione pelo menos uma popula√ß√£o cl√≠nica antes de usar as palavras-chave.");
            return;
          }
          const indexUltimaPop = populations.length - 1;
          const objInput = document.getElementById(`objInput${indexUltimaPop}`);
          if (!objInput) return;
          if (objInput.value.length > 0 && !objInput.value.endsWith(' ')) objInput.value += ' ';
          objInput.value += palavra;
          objInput.focus();
          mostrarSugestaoFerramenta(indexUltimaPop);
        });
        ul.appendChild(li);
      });
    }

    // Preencher biblioteca das ferramentas com descri√ß√µes e suas palavras-chave relacionadas
    function preencherBiblioteca() {
      const ul = document.getElementById('libraryList');
      ul.innerHTML = '';
      bibliotecaFerramentas.forEach(ferramenta => {
        // Procurar palavras-chave relacionadas a essa ferramenta
        const relacionadas = Object.entries(palavraParaFerramentas)
          .filter(([palavra, ferramentas]) => ferramentas.includes(ferramenta.nome))
          .map(([palavra]) => palavra);
        const li = document.createElement('li');
        li.innerHTML = `<strong>${ferramenta.nome}:</strong> ${ferramenta.descricao} <br/><em>Palavras-chave relacionadas:</em> ${relacionadas.join(', ')}`;
        ul.appendChild(li);
      });
    }

    // Eventos para Enter nas entradas principais
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('popInput').addEventListener('keydown', e => {
        if (e.key === 'Enter') addPopulation();
      });
      document.getElementById('participantInput').addEventListener('keydown', e => {
        if (e.key === 'Enter') addParticipant();
      });

      preencherPalavrasChave();
      preencherBiblioteca();
    });
  </script>
</body>
</html>
