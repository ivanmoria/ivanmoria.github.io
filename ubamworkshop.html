<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Sorteio Workshop UBAM</title>
  <style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #f0f4f8;
  padding: 30px;
  margin: 0;
  display: flex;
  flex-direction: row;
  overflow-x: hidden; /* Evita scroll horizontal desnecess√°rio */
}

.main-content {
  flex: 1;
  max-width: calc(100% - 650px);
  padding-right: 20px;
}

h1, h3 {
  text-align: center;
  color: #2c3e50;
}

.section {
  background: #ffffff;
  padding: 20px;
  margin: 20px auto;
  border-radius: 10px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.05);
  max-width: 800px;
}

input[type="text"] {
  width: calc(100% - 20px);
  padding: 10px;
  margin: 10px 0;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 15px;
}

button {
  padding: 8px 14px;
  margin: 5px 4px;
  background-color: #3498db;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  transition: background-color 0.2s ease;
}

button:hover {
  background-color: #2980b9;
}

.remove-btn {
  background-color: #e74c3c;
}

.remove-btn:hover {
  background-color: #c0392b;
}

.population, .participant-item {
  border: 1px solid #ddd;
  padding: 15px;
  margin-bottom: 15px;
  border-radius: 8px;
  background: #f9f9f9;
}

.objectives {
  margin-top: 10px;
  padding-left: 15px;
  color: #555;
}

.results {
  white-space: pre-wrap;
  background: #ecf3fc;
  padding: 20px;
  border-radius: 8px;
  border: 1px solid #cde;
  font-family: monospace;
  font-size: 15px;
  color: #2c3e50;
}
.link-lab a,
.library a {
  font-size: 16px;
  color: #1e90ff;          /* Azul mais suave, mais agrad√°vel */
  text-decoration: none;
  transition: color 0.3s ease;
  outline: none;           /* Remove o contorno padr√£o ao focar */
}

.link-lab a:hover,
.library a:hover {
  text-decoration: underline;
  color: #104e8b;          /* Azul mais escuro ao passar mouse */
}

/* Remove contorno azul no clique/foco */
.link-lab a:focus,
.library a:focus {
  outline: none;
  box-shadow: none;
}

/* === Sidebar melhorado === */
.sidebar {
  width: 650px;
  background-color: #fffdf5;
  border-left: 2px solid #f0d98c;
  padding: 25px 20px;
  position: fixed;
  top: 0;
  right: 0;
  height: 100vh; /* Limita a altura total √† tela */
  box-sizing: border-box;
  box-shadow: -2px 0 6px rgba(0, 0, 0, 0.05);
  display: flex;
  flex-direction: column;
}

/* Scroll apenas na lista se necess√°rio */
.sidebar ul {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap: 10px;
  list-style: none;
  padding: 0;
  margin: 0;
  overflow-y: auto;
  flex-grow: 1;
  scrollbar-width: thin;
  scrollbar-color: #f0d98c #fffdf5;
}

.sidebar ul::-webkit-scrollbar {
  width: 8px;
}

.sidebar ul::-webkit-scrollbar-track {
  background: #fffdf5;
}

.sidebar ul::-webkit-scrollbar-thumb {
  background-color: #f0d98c;
  border-radius: 10px;
}

.sidebar h3 {
  flex-shrink: 0;
  position: sticky;
  top: 0;
  background: #fffdf5;
  padding-bottom: 10px;
  margin: 0 0 12px 0;
  border-bottom: 2px solid #f0d98c;
  font-weight: 700;
  font-size: 20px;
  z-index: 10;
}

.sidebar li {
  background: #ffeebb;
  padding: 8px 10px; /* Reduz o espa√ßamento interno */
  border-radius: 6px; /* Pode reduzir um pouco para acompanhar o tamanho */
  font-size: 13px;    /* Diminui a fonte */
  font-weight: 600;
  color: #333;
  box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.05);
  text-align: center;
  cursor: pointer;
  user-select: none;
  transition: background-color 0.2s ease;
  line-height: 1.2; /* Mais compacto verticalmente */
}
.sidebar ul {
  grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
}

.sidebar li:hover {
  background-color: #ffd966;
}


/* === Biblioteca (rodap√©) === */
.library {
  background: #fff8dc;
  border-top: 2px solid #f0d98c;
  padding: 20px;
  margin-top: 30px;
  max-width: 800px;
  margin-left: auto;
  margin-right: auto;
  border-radius: 8px;
  color: #333;
  font-size: 15px;
  max-height: none;
  overflow-y: visible;
}

.library h3 {
  margin-top: 0;
  font-weight: 700;
  color: #2c3e50;
}

.library ul {
  padding-left: 20px;
  margin-top: 10px;
  max-height: none;
  overflow-y: visible;
}

.library li {
  margin-bottom: 14px;
}

.library strong {
  color: #2980b9;
}

  </style>
</head>
<body>

  <div class="main-content">
    <h1>Sorteio de Desafio Musicoterap√™utico</h1>

    
<div class="section">
  <h3>Proposta da atividade</h3>
  <p>
    Cada participante receber√° um desafio musicoterap√™utico baseado em uma popula√ß√£o espec√≠fica e objetivos sugeridos. 
    Sua tarefa √© utilizar uma ou mais ferramentas do  <strong> <a href="https://musiclab.chromeexperiments.com/" target="_blank">Google Chrome Music Lab</a>
</strong> para criar um exemplo de recurso ou processo terap√™utico 
    <em>(dura√ß√£o entre 1 a 3 minutos)</em> que possa ser utilizado em uma sess√£o de musicoterapia com essa popula√ß√£o.
  </p>
</div>

    <div class="section">
      <h3>1. Adicionar Popula√ß√£o Cl√≠nica</h3>
      <input type="text" id="popInput" placeholder="Ex: Crian√ßas com autismo" />
      <button onclick="addPopulation()">+ Adicionar Popula√ß√£o</button>
      <div id="populationsContainer"></div>
    </div>

    <div class="section">
      <h3>2. Adicionar Participantes</h3>
      <input type="text" id="participantInput" placeholder="Nome do participante" />
      <button onclick="addParticipant()">+ Adicionar Participante</button>
      <div id="participantsList"></div>
      <button onclick="sortear()">üé≤ Sortear</button>
    </div>

    <div class="section">
      <h3>3. Resultado do Sorteio</h3>
      <div class="results" id="results">Nenhum sorteio realizado ainda.</div>
    </div>

    <div class="library">
      <h3>üìö Biblioteca das Ferramentas do Chrome Music Lab</h3>
      <ul id="libraryList"></ul>
    </div>
  </div>

  <div class="sidebar">
    <h3>üìå Palavras-chave</h3>
    <ul id="listaPalavrasChave"></ul>
  </div>

  <script>
    // Biblioteca com ferramentas e descri√ß√µes
    const bibliotecaFerramentas = [
        {nome: "Arpeggios", descricao: "Explora√ß√£o de sequ√™ncias de notas tocadas em sucess√£o r√°pida.", url: "https://musiclab.chromeexperiments.com/Arpeggios/" },
        { nome: "Chords", descricao: "Cria√ß√£o e experimenta√ß√£o com acordes musicais.", url: "https://musiclab.chromeexperiments.com/Chords/" },
        { nome: "Harmonics", descricao: "Explora√ß√£o de sons harm√¥nicos e suas rela√ß√µes musicais.", url: "https://musiclab.chromeexperiments.com/Harmonics/" },
        { nome: "Kandinsky", descricao: "Gera√ß√£o visual e sonora interativa baseada em formas e cores.", url: "https://musiclab.chromeexperiments.com/Kandinsky/" },
        { nome: "Melody Maker", descricao: "Cria√ß√£o e edi√ß√£o de melodias com v√°rias op√ß√µes de notas e escalas.", url: "https://musiclab.chromeexperiments.com/Melody-Maker/" },
        { nome: "Oscillators", descricao: "Gera√ß√£o de sons baseados em ondas oscilat√≥rias, √∫til para est√≠mulos sonoros e movimento.", url: "https://musiclab.chromeexperiments.com/Oscillators/" },
        { nome: "Piano Roll", descricao: "Visualiza√ß√£o e edi√ß√£o de notas musicais em formato de piano roll.", url: "https://musiclab.chromeexperiments.com/Piano-Roll/" },
        { nome: "Rhythm", descricao: "Explora√ß√£o e cria√ß√£o de padr√µes r√≠tmicos e movimentos corporais.", url: "https://musiclab.chromeexperiments.com/Rhythm/" },
        { nome: "Shared Piano", descricao: "Incr√≠vel para atendimentos de musicoterapia online. Permite tocar piano com m√∫ltiplos usu√°rios simultaneamente.", url: "https://musiclab.chromeexperiments.com/Shared-Piano/" },
        { nome: "Song Maker", descricao: "Cria√ß√£o e edi√ß√£o de m√∫sicas simples, com ritmo, melodia e harmonia.", url: "https://musiclab.chromeexperiments.com/Song-Maker/" },
        { nome: "Sound Waves", descricao: "Visualiza√ß√£o das ondas sonoras e experimenta√ß√£o com frequ√™ncias.", url: "https://musiclab.chromeexperiments.com/Sound-Waves/" },
        { nome: "Spectrogram", descricao: "Visualiza√ß√£o gr√°fica do espectro sonoro, √∫til para percep√ß√£o auditiva.", url: "https://musiclab.chromeexperiments.com/Spectrogram/" },
        { nome: "Strings", descricao: "Explora√ß√£o sonora de instrumentos de cordas virtuais.", url: "https://musiclab.chromeexperiments.com/Strings/" },
        { nome: "Voice Spinner", descricao: "Manipula√ß√£o de grava√ß√µes de voz com efeitos de looping e varia√ß√µes.", url: "https://musiclab.chromeexperiments.com/Voice-Spinner/" }
      ];

    // Mapeamento palavras-chave para ferramentas
    const palavraParaFerramentas = {
      "express√£o": ["Kandinsky", "Song Maker"],
      "identidade": ["Shared Piano", "Melody Maker"],
      "mem√≥ria": ["Melody Maker", "Piano Roll"],
      "autoestima": ["Kandinsky", "Shared Piano"],
      "explora√ß√£o": ["Song Maker", "Shared Piano","Strings", "Oscillators"],
      "emo√ß√£o": ["Kandinsky", "Song Maker"],
      "sentimento": ["Kandinsky", "Song Maker"],
      "afetividade": ["Kandinsky", "Song Maker"],
      "catarsis": ["Kandinsky", "Song Maker"],
      "comunica√ß√£o": ["Song Maker","Spectrogram","Shared Piano", "Rhythm"],
      "linguagem": ["Song Maker","Spectrogram", "Shared Piano","Rhythm"],
      "intera√ß√£o": ["Song Maker","Shared Piano", "Rhythm"],
      "di√°logo": ["Song Maker", "Rhythm"],
      "socializa√ß√£o": ["Song Maker", "Shared Piano","Rhythm"],
      "coordena√ß√£o": ["Rhythm", "Oscillators"],
      "motora": ["Rhythm", "Oscillators"],
      "gesto": ["Rhythm", "Oscillators"],
      "movimento": ["Rhythm", "Oscillators"],
      "corporal": ["Rhythm", "Oscillators"],
      "escuta": ["Sound Waves", "Spectrogram", "Harmonics"],
      "audi√ß√£o": ["Sound Waves", "Spectrogram", "Harmonics"],
      "aten√ß√£o": ["Sound Waves", "Spectrogram"],
      "foco": ["Sound Waves", "Spectrogram"],
      "concentra√ß√£o": ["Sound Waves", "Spectrogram"],
      "percep√ß√£o": ["Sound Waves", "Oscillators","Spectrogram", "Harmonics"],
      "cria√ß√£o": ["Song Maker", "Kandinsky", "Melody Maker", "Voice Spinner"],
      "criatividade": ["Song Maker", "Shared Piano","Kandinsky", "Melody Maker", "Voice Spinner"],
      "improvisa√ß√£o": ["Song Maker","Spectrogram","Arpeggios","Shared Piano", "Kandinsky", "Melody Maker", "Shared Piano"],
      "compor": ["Song Maker", "Melody Maker", "Chords", "Piano Roll"],
      "inventar": ["Song Maker", "Shared Piano","Kandinsky", "Melody Maker"],
      "l√∫dico": ["Song Maker", "Kandinsky"],
      "organiza√ß√£o": ["Rhythm", "Melody Maker", "Chords"],
      "estrutura": ["Rhythm", "Melody Maker", "Chords"],
      "sequ√™ncia": ["Rhythm", "Arpeggios","Melody Maker", "Chords"],
      "tempo": ["Rhythm", "Melody Maker", "Chords"],
      "padr√£o": ["Rhythm", "Melody Maker", "Chords"],
      "repeti√ß√£o": ["Rhythm", "Melody Maker", "Chords"],
      "afina√ß√£o": ["Melody Maker","Oscillators", "Song Maker", "Chords"],
      "notas": ["Melody Maker", "Oscillators","Shared Piano","Arpeggios","Song Maker", "Piano Roll", "Chords"],
      "escala": ["Melody Maker", "Song Maker", "Piano Roll"],
      "melodia": ["Melody Maker","Spectrogram","Arpeggios", "Song Maker"],
      "harmonia": ["Melody Maker", "Song Maker", "Chords"],
      "intervalo": ["Melody Maker", "Song Maker"],
      "visual": ["Kandinsky","Oscillators", "Spectrogram"],
      "auditivo": ["Sound Waves", "Spectrogram"],
      "sensorial": ["Kandinsky","Spectrogram", "Spectrogram"],
      "sinestesia": ["Kandinsky"],
      "est√≠mulo": ["Kandinsky", "Sound Waves", "Oscillators"],
      "sentidos": ["Kandinsky", "Sound Waves"],
      "relaxamento": ["Song Maker (modo lento)", "Spectrogram"],
      "ansiedade": ["Song Maker (modo lento)", "Spectrogram"],
      "calma": ["Song Maker (modo lento)", "Spectrogram"],
      "respira√ß√£o": ["Song Maker (modo lento)", "Spectrogram"],
      "tranquilidade": ["Song Maker (modo lento)", "Spectrogram"],
      "grupo": ["Rhythm (em duplas)","Shared Piano", "Song Maker (colaborativo)"],
      "v√≠nculo": ["Rhythm (em duplas)", "Shared Piano","Song Maker (colaborativo)"],
      "empatia": ["Rhythm (em duplas)", "Shared Piano","Song Maker (colaborativo)"],
      "espelhamento": ["Rhythm (em duplas)", "Song Maker (colaborativo)"],
      "rela√ß√£o": ["Rhythm (em duplas)","Shared Piano", "Song Maker (colaborativo)"],
      "troca": ["Rhythm (em duplas)", "Shared Piano","Song Maker (colaborativo)"]
    };

    // Extrair palavras-chave √∫nicas e ordenar
    const palavrasChave = Object.keys(palavraParaFerramentas).sort();

    let populations = [];
    let participants = [];

    function addPopulation() {
      const popName = document.getElementById('popInput').value.trim();
      if (!popName) return;
      populations.push({ name: popName, objectives: [] });
      document.getElementById('popInput').value = '';
      renderPopulations();
    }

    function addObjective(index) {
      const objInput = document.getElementById(`objInput${index}`);
      const objective = objInput.value.trim();
      if (!objective) return;
      populations[index].objectives.push(objective);
      objInput.value = '';
      renderPopulations();
    }

    function removePopulation(index) {
      populations.splice(index, 1);
      renderPopulations();
    }

    function renderPopulations() {
      const container = document.getElementById('populationsContainer');
      container.innerHTML = '';
      populations.forEach((pop, index) => {
        const div = document.createElement('div');
        div.className = 'population';
        div.innerHTML = `
          <strong>${pop.name}</strong>
          <button class="remove-btn" onclick="removePopulation(${index})">Remover</button>
          <div class="objectives">
            ${pop.objectives.length ? pop.objectives.map(obj => `<div>‚Ä¢ ${obj}</div>`).join('') : '<em>Nenhum objetivo ainda</em>'}
          </div>
          <input type="text" id="objInput${index}" placeholder="Adicionar objetivo cl√≠nico..." 
                 onkeydown="if(event.key==='Enter') addObjective(${index})" 
                 oninput="mostrarSugestaoFerramenta(${index})" />
          <div id="sugestao${index}" style="font-size: 13px; color: #555; margin-top: 4px;"></div>
          <button onclick="addObjective(${index})">+ Objetivo</button>
        `;
        container.appendChild(div);
      });
    }

    function addParticipant() {
      const input = document.getElementById('participantInput');
      const name = input.value.trim();
      if (!name) return;
      participants.push(name);
      input.value = '';
      renderParticipants();
    }

    function removeParticipant(index) {
      participants.splice(index, 1);
      renderParticipants();
    }

    function renderParticipants() {
      const list = document.getElementById('participantsList');
      list.innerHTML = '';
      participants.forEach((name, index) => {
        const div = document.createElement('div');
        div.className = 'participant-item';
        div.innerHTML = `
          <strong>${name}</strong>
          <button class="remove-btn" onclick="removeParticipant(${index})">Remover</button>
        `;
        list.appendChild(div);
      });
    }

    function sugerirFerramenta(texto) {
      texto = texto.toLowerCase();
      for (let palavra in palavraParaFerramentas) {
        if (texto.includes(palavra)) {
          return palavraParaFerramentas[palavra].join(", ");
        }
      }
      return "Escolha livre no Music Lab üéß";
    }

    function mostrarSugestaoFerramenta(index) {
      const objInput = document.getElementById(`objInput${index}`);
      const sugestaoDiv = document.getElementById(`sugestao${index}`);
      const texto = objInput.value.toLowerCase().trim();

      const ferramenta = sugerirFerramenta(texto);
      let sugestaoHTML = `üéß <strong>Sugest√£o de ferramenta:</strong> ${ferramenta}<br/>`;

      if (texto.length >= 1) {
        const sugestoes = palavrasChave.filter(p => p.startsWith(texto)).slice(0, 5);
        if (sugestoes.length) {
          sugestaoHTML += `üîç <strong>Palavras-chave:</strong> ${sugestoes.join(", ")}`;
        }
      }

      sugestaoDiv.innerHTML = sugestaoHTML;
    }

    // Sorteio
    function sortear() {
      const resultsDiv = document.getElementById('results');
      if (participants.length === 0 || populations.length === 0) {
        alert("Adicione participantes e popula√ß√µes cl√≠nicas.");
        return;
      }
      const output = [];
      const usedPopulations = new Set();

      participants.forEach((name) => {
        let popOptions = populations.filter((_, idx) => !usedPopulations.has(idx));
        if (popOptions.length === 0) popOptions = populations;
        const popIndex = populations.indexOf(popOptions[Math.floor(Math.random() * popOptions.length)]);
        usedPopulations.add(popIndex);
        const pop = populations[popIndex];

        let chosenObjective = '';
        let sugestao = '';
        if (pop.objectives.length === 0) {
          chosenObjective = '‚ö†Ô∏è Sem objetivo cl√≠nico definido.';
          sugestao = 'Sem sugest√£o de ferramenta.';
        } else {
          if (!pop._usedObjectives) pop._usedObjectives = new Set();
          let availableObjectives = pop.objectives.filter((_, idx) => !pop._usedObjectives.has(idx));
          if (availableObjectives.length === 0) {
            pop._usedObjectives = new Set();
            availableObjectives = pop.objectives;
          }
          const objIndex = pop.objectives.indexOf(availableObjectives[Math.floor(Math.random() * availableObjectives.length)]);
          pop._usedObjectives.add(objIndex);
          chosenObjective = pop.objectives[objIndex];
          sugestao = sugerirFerramenta(chosenObjective);
        }

        output.push(`${name}:\nPopula√ß√£o: ${pop.name}\nObjetivo: ${chosenObjective}\nüéß Sugest√£o de ferramenta: ${sugestao}\n`);
      });

      resultsDiv.textContent = output.join('\n---\n');
    }

    // Preencher palavras-chave na sidebar e adicionar clique para inserir no √∫ltimo input objetivo
    function preencherPalavrasChave() {
      const ul = document.getElementById('listaPalavrasChave');
      ul.innerHTML = '';
      palavrasChave.forEach(palavra => {
        const li = document.createElement('li');
        li.textContent = palavra;
        li.title = `Inserir "${palavra}" no objetivo cl√≠nico da √∫ltima popula√ß√£o`;
        li.addEventListener('click', () => {
          if (populations.length === 0) {
            alert("Adicione pelo menos uma popula√ß√£o cl√≠nica antes de usar as palavras-chave.");
            return;
          }
          const indexUltimaPop = populations.length - 1;
          const objInput = document.getElementById(`objInput${indexUltimaPop}`);
          if (!objInput) return;
          if (objInput.value.length > 0 && !objInput.value.endsWith(' ')) objInput.value += ' ';
          objInput.value += palavra;
          objInput.focus();
          mostrarSugestaoFerramenta(indexUltimaPop);
        });
        ul.appendChild(li);
      });
    }

    // Preencher biblioteca das ferramentas com descri√ß√µes e suas palavras-chave relacionadas
   function preencherBiblioteca() {
    const ul = document.getElementById('libraryList');
    ul.innerHTML = '';
    bibliotecaFerramentas.forEach(ferramenta => {
      const relacionadas = Object.entries(palavraParaFerramentas)
        .filter(([palavra, ferramentas]) => ferramentas.includes(ferramenta.nome))
        .map(([palavra]) => palavra);
      const li = document.createElement('li');
      li.innerHTML = `<strong><a href="${ferramenta.url}" target="_blank" rel="noopener noreferrer">${ferramenta.nome}</a>:</strong> ${ferramenta.descricao} <br/><em>Palavras-chave relacionadas:</em> ${relacionadas.join(', ')}`;
      ul.appendChild(li);
    });
  }
    // Eventos para Enter nas entradas principais
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('popInput').addEventListener('keydown', e => {
        if (e.key === 'Enter') addPopulation();
      });
      document.getElementById('participantInput').addEventListener('keydown', e => {
        if (e.key === 'Enter') addParticipant();
      });

      preencherPalavrasChave();
      preencherBiblioteca();
    });
  </script>
</body>
</html>
