<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste DASS-21</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .results {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>Teste DASS-21</h1>
    <form id="dassForm">
        <label for="csvFile">Carregar arquivo CSV:</label>
        <input type="file" id="csvFile" accept=".csv" required>
        <button type="button" onclick="processCSV()">Calcular</button>
    </form>

    <div id="results" class="results" style="display: none;">
        <h2>Resultados</h2>
        <p><strong>Depressão:</strong> <span id="depressao"></span></p>
        <p><strong>Ansiedade:</strong> <span id="ansiedade"></span></p>
        <p><strong>Estresse:</strong> <span id="estresse"></span></p>
    </div>

    <script>
        function classifyDepression(score) {
            if (score < 10) return 'Normal';
            if (score <= 13) return 'Leve';
            if (score <= 20) return 'Moderado';
            if (score <= 27) return 'Severo';
            return 'Extremamente Severo';
        }

        function classifyAnxiety(score) {
            if (score < 8) return 'Normal';
            if (score <= 9) return 'Leve';
            if (score <= 14) return 'Moderado';
            if (score <= 19) return 'Severo';
            return 'Extremamente Severo';
        }

        function classifyStress(score) {
            if (score < 15) return 'Normal';
            if (score <= 18) return 'Leve';
            if (score <= 25) return 'Moderado';
            if (score <= 33) return 'Severo';
            return 'Extremamente Severo';
        }

        function processCSV() {
            const fileInput = document.getElementById('csvFile');
            const file = fileInput.files[0];

            if (!file) {
                alert('Por favor, selecione um arquivo CSV.');
                return;
            }

            Papa.parse(file, {
                delimiter: " ",  // Specifies that the delimiter is a space
                header: true,
                dynamicTyping: true,
                complete: function(results) {
                    const data = results.data;
                    
                    // Índices das subescalas
                    const depressaoIndices = [2, 4, 9, 12, 15, 16, 20];
                    const ansiedadeIndices = [1, 3, 6, 8, 14, 18, 19];
                    const estresseIndices = [0, 5, 7, 10, 11, 13, 17];

                    // Converter respostas
                    const respostas = data.map(row => parseInt(row.Resposta || 0, 10));

                    const depressao = depressaoIndices.reduce((sum, i) => sum + (respostas[i] || 0), 0) * 2;
                    const ansiedade = ansiedadeIndices.reduce((sum, i) => sum + (respostas[i] || 0), 0) * 2;
                    const estresse = estresseIndices.reduce((sum, i) => sum + (respostas[i] || 0), 0) * 2;

                    // Exibir resultados
                    document.getElementById('depressao').textContent = `${depressao} - ${classifyDepression(depressao)}`;
                    document.getElementById('ansiedade').textContent = `${ansiedade} - ${classifyAnxiety(ansiedade)}`;
                    document.getElementById('estresse').textContent = `${estresse} - ${classifyStress(estresse)}`;

                    document.getElementById('results').style.display = 'block';
                },
                error: function(err) {
                    console.error('Erro ao processar o arquivo:', err);
                }
            });
        }
    </script>
</body>
</html>
